(function($global){if(typeof $global.ssla=="undefined"){$global.ssla={}}var ssla=$global.ssla;ssla.net=ssla.net?ssla.net:{};ssla.analytics=ssla.analytics?ssla.analytics:{};ssla.analytics.omniture=ssla.analytics.omniture?ssla.analytics.omniture:{};ssla.net.NetInfo={};ssla.net.NetInfo.getUrl=function(){return document.domain};ssla.net.NetInfo.getHash=function(){return window.location.hash};ssla.net.NetInfo.getSiteId=function(){var id;var query=window.location.search;if(query==null||query==""){id=""}else{id=ssla.net.NetInfo.getQueryVariable(query,"siteid")}return id};ssla.net.NetInfo.getQueryVariable=function($query,$varName){$query=$query.substring(1);var vars=$query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==$varName){return pair[1]}}return""};ssla.analytics.omniture.Accounts=function($arr){this._data=[];this._count=0;if($arr instanceof Array){for(var i in $arr){var o=$arr[i];if(o.account==undefined||o.address==undefined||o.account==""||o.account==""){throw new Error("Accounts data is invalid");return false}}this._data=$arr}};ssla.analytics.omniture.Accounts.prototype.next=function(){var o=this._data[this._count];this._count++;return o};ssla.analytics.omniture.Accounts.prototype.hasNext=function(){if(this._count<this._data.length){return true}return false};ssla.analytics.omniture.Accounts.prototype.addAccount=function($accountName,$address){this._data.push(new ssla.analytics.omniture.Account($accountName,$address))};ssla.analytics.omniture.Accounts.prototype.getAccount=function(){var account;var host=ssla.net.NetInfo.getUrl();if(!this._data.length){account=host.match(/((staging|devcpd\d|dev)\.toyota)\.com$|localhost|tmspreview.com/i)?"devtoyota":"tmstoyota"}else{while(this.hasNext()){var a=this.next();var regex=new RegExp(a.address,"i");if(regex.test(host)){account=a.account;break}}}return account};ssla.analytics.omniture.Account=function($account,$address){this.account=$account;this.address=$address};ssla.analytics.Omniture=function($library,$s){this.library=$library;this.s=$s;this.s.campaign=ssla.net.NetInfo.getSiteId()};ssla.analytics.Omniture.prototype.constructor=ssla.analytics.Omniture;ssla.analytics.Omniture.prototype.clear=function(){for(var i=1;i<=75;i++){this.s["prop"+i]="";this.s["eVar"+i]=""}this.s.pageName="";this.s.channel="";this.s.events="";this.s.campaign="";this.s.linkTrackVars=""};ssla.analytics.Omniture.prototype.sendId=function($id){try{var obj=this.getItem($id)}catch($e){return false}this.send(obj);return true};ssla.analytics.Omniture.prototype.getItem=function($id){var obj=this.library[$id];if(obj==undefined){throw new Error("[Omniture] Item doesn't exist")}else{var clone={};for(var i in obj){clone[i]=obj[i]}return clone}};ssla.analytics.Omniture.prototype.send=function($obj){this.clear();var func=this._getJSFunction($obj);func();if($obj.method.toLowerCase()=="tracklink"){var n="";typeof($obj.pev2)==String?n=$obj.pev2:n=$obj.name;this._trackLink(document.location,$obj.type,n)}else{this._track()}this.clear()};ssla.analytics.Omniture.prototype._getJSFunction=function($obj){var func="";var ltv="";var method=this._getMethod($obj);for(var i in $obj){if(!i.match(/(pev2|type|method)/i)&&i!=="name"){func=func.concat("s.").concat(i).concat("='").concat($obj[i]).concat("';");ltv+=i+","}}if(ltv.length>0&&method.toLowerCase()=="tracklink"){ltv=ltv.substring(0,ltv.length-1);func=func.concat("s.linkTrackVars='"+ltv+"';")}var fn=new Function(func);return fn};ssla.analytics.Omniture.prototype._getMethod=function($obj){var method="";if($obj.method==undefined){if($obj.pageName!=undefined){method="track"}else{if($obj.pev2==undefined&&$obj.name==undefined){throw new Error('[Omniture] trackLink is assumed, a "name" or "pev2" must be added to library item.')}if($obj.type==undefined){throw new Error('[Omniture] trackLink is assumed, a "type" must be added to library item.')}method="trackLink"}$obj.method=method}else{method=$obj.method}return method};ssla.analytics.Omniture.prototype._track=function(){this.s.t()};ssla.analytics.Omniture.prototype._trackLink=function($url,$type,$name){alert("trackLink");if($url==undefined||$type==undefined||$name==undefined){throw new Error("[Omniture] trackLink parameter(s) are missing");return false}this.s.tl($url,$type,$name)};ssla.analytics.Omniture.constructor.accounts=new ssla.analytics.omniture.Accounts();ssla.analytics.Omniture.addAccount=function($account,$host){ssla.analytics.Omniture.constructor.accounts.addAccount($account,$host)};ssla.analytics.Omniture.getAccount=function(){var a=ssla.analytics.Omniture.constructor.accounts.getAccount();ssla.analytics.Omniture.constructor.accounts=new ssla.analytics.omniture.Accounts();return a}})((typeof window=="undefined")?this:window);